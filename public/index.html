<title>OFBiz minilang to Java</title>

<style>
    body {
        background-color: #2f3129;
        margin: 0;
        padding: 0;
    }

    #container {
        height: 100vh;
        width: 100vw;
        display: grid;
        grid-template-areas:
            "input output"
            "controls controls";
        grid-template-columns: 1fr 1fr;
        grid-template-rows: 1fr 5em;
    }

    #input {
        width: 100%;
        height: 100%;
        grid-area: input;
    }

    #output {
        width: 100%;
        height: 100%;
        grid-area: output;
    }

    #controls {
        grid-area: controls;
        color: white;
        font-family: "Courier New", Courier, monospace;
    }
</style>

<div id="container">
    <div id="input"></div>
    <div id="output"></div>
    <div id="controls">
        <input type="text" id="className" placeholder="Class name" />
        <input type="text" id="classPath" placeholder="Class path" />
        <label><input type="radio" name="mode" value="SERVICE" />Service</label>
        <label><input type="radio" name="mode" value="EVENT" />Event</label>
        <label
            ><input
                type="radio"
                name="mode"
                value="GENERIC"
                checked
            />Generic</label
        >
        <button id="submit">Convert</button>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.2/ace.js"></script>
<script>
    window.addEventListener("load", () => {
        const $input = document.querySelector("#input");
        const $output = document.querySelector("#output");
        const $methodMode = document.querySelector(
            "input[name='mode']:checked"
        );
        const $className = document.querySelector("#className");
        const $classPath = document.querySelector("#classPath");

        ace.edit("input", {
            mode: "ace/mode/xml",
            selectionStyle: "text",
            wrap: true,
            theme: "ace/theme/monokai",
        });

        ace.edit("output", {
            mode: "ace/mode/groovy",
            selectionStyle: "text",
            wrap: true,
            theme: "ace/theme/monokai",
        });

        ace.edit("input")
            .getSession()
            .setValue(localStorage.getItem("editor.inputText") ?? "");
        $className.value = localStorage.getItem("editor.className") ?? "";
        $classPath.value = localStorage.getItem("editor.classPath") ?? "";

        document.querySelector("#submit").addEventListener("click", () => {
            document.querySelector("#submit").disabled = "disabled";
            const input = ace.edit("input").getSession().getValue();

            localStorage.setItem("editor.inputText", input);
            localStorage.setItem("editor.className", $className.value);
            localStorage.setItem("editor.classPath", $classPath.value);
            localStorage.setItem("editor.methodMode", $methodMode.value);

            fetch("/convert", {
                method: "post",
                headers: {
                    "Accept": "application/json",
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    input,
                    className: $className.value,
                    classPath: $classPath.value,
                    methodMode: $methodMode.value,
                }),
            })
                .then((res) => {
                    return res.json();
                })
                .then((data) => {
                    if (data && data.output) {
                        ace.edit("output").getSession().setValue(data.output);
                    } else {
                        ace.edit("output").getSession().setValue(data);
                    }
                })
                .catch((err) => {
                    console.error(err);
                    ace.edit("output").getSession().setValue(err.toString());
                })
                .finally(() => {
                    document.querySelector("#submit").disabled = undefined;
                });
        });
    });
</script>
